# Установка
1. Клонировать (`git clone https://github.com/kudraem/b24_products_fields_to_deal_fields.git`) репозиторий в целевой каталог.
2. Запустить команду `composer install`. Если `composer` не установлен, то воспользоваться [данной инструкцией](https://getcomposer.org/doc/00-intro.md#installation-linux-unix-macos).

3. В целевом Битрикс24 создать входящий вебхук с правами `CRM`. Для этого необходимо осуществить следующие действия 
	- перейти в главном меню в раздел `Разработчикам`
	- нажать на кнопку `Другое`
	- нажать на кнопку `Входящий вебхук`
	- в появившемся окне в разделе `Настройка прав` выбрать пункт `CRM`
	- сохранить в надежном месте секрет вебхука, то есть текстовое значение, указанное в поле `Вебхук для вызова rest api`. Данное значение потребуется в следующем пункте.
	- нажать на кнопку `Сохранить`

4. Создать файл `.env` для конфигурации приложения, установив
   - в качестве значения ключа `DEBUG` - `1` или `0` в зависимости от необходимости включение режима отладки
   - в качестве значения ключа `BITRIX24_DOMAIN` - домен вашего Битрикс24, например: `companyname.bitrix24.ru`
   - в качестве значения ключа `BITRIX24_WEBHOOK_SECRET` - секрет вебхука, созданного на предыдущем этапе (указывать необходимо вебхук вместе с id пользователя, создавшего вебхук, например, `1/oxgd07mq6ba35bhn/`)
   - в качестве значения ключа `APP_SECRET` - любой набор случайных символов, которые будут использоваться в качестве пароля.
   
   В качестве примера форматирования файла `.env` можно использовать файл `.env.sample`

5. В Битрикс24 создать нового робота для запуска копирования полей. Для этого необходимо осуществить следующие действия
	- перейти в главном меню в раздел `CRM`
	- перейти в раздел `Сделки`
	- нажать на кнопку `Роботы`
	- нажать на кнопку `Настроить роботов`
	- под каждой стадией сделки, при переходе (или создании) на которую должно запускаться копирование необходимо осуществить следующие действия:
		- нажать на кнопку `Добавить`
		- в появившемся списке выбрать пункт `Свои роботы` / `Webhook`
		- в появившемся окне ввести в текстовое поле URL обработчика, по которому можно обратиться к файлу `app.php`, дополнительно указав параметры `deal_id={{ID}}&secret=xed312ad1asdr`, где `deal_id` - параметр, в который автоматически будет подставляться id сделки, а `secret` - специальный секрет в целях безопасности, значение которого должно совпадать с соответствующим ему значением в файле `/.env` (ключ `APP_SECRET`). В итоге должен получиться URL, вроде данного: `https://f1c5e45b6786.ngrok.io/app.php?deal_id={{ID}}&secret=xed312ad1asdr`

		- нажать на кнопку `Сохранить`

6. Проверить корректную работу файлов `.htaccess` с целью удостовериться в том, что файлы, содержание которых должно быть скрыто, не доступны публично, в частности конфигурационный файл `.env`. Для этого в браузере попробуйте ввести URL файла `.env`. В случае корреткной работы, браузер вернет ошибку и не отобразить содержание файла `.env`.